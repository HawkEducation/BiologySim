<!DOCTYPE html>
<html>
<head>
    <style>
        body { background: #050505; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: 'Courier New', Courier, monospace; color: #b0f; }
        #main-container { display: flex; gap: 10px; border: 2px solid #442244; padding: 10px; background: #110011; }
        canvas { image-rendering: pixelated; background: #0a000a; display: block; border: 1px solid #663366; }
        #log-container { width: 260px; height: 480px; background: #000; border: 1px solid #331133; padding: 10px; font-size: 11px; overflow: hidden; display: flex; flex-direction: column-reverse; }
        .log-entry { margin-bottom: 2px; border-bottom: 1px solid #220022; }
        .extinction { color: #ff0000; font-weight: bold; background: #330000; }
        .virus { color: #bb00ff; }
        .immune { color: #ffff00; }
    </style>
</head>
<body>

<div id="main-container">
    <canvas id="simCanvas" width="640" height="480"></canvas>
    <div id="log-container"></div>
</div>

<script>
const canvas = document.getElementById('simCanvas');
const ctx = canvas.getContext('2d');
const logEl = document.getElementById('log-container');

const CELL_SIZE = 16; 
const COLS = 40; 
const ROWS = 30;

let grid = Array.from({ length: COLS }, () => Array(ROWS).fill(null));
let creatures = [];
let eggs = [];

const colonies = [
    {x: 4, y: 4, id: 1, color: '#ff99ff', sColor: '#ff55cc', qColor: '#ff00ff'},
    {x: COLS-5, y: ROWS-5, id: 2, color: '#99ffff', sColor: '#55ffff', qColor: '#00ffff'}
];

function addLog(text, type) {
    const entry = document.createElement('div');
    entry.className = `log-entry ${type}`;
    entry.innerText = `> ${text}`;
    logEl.prepend(entry);
    if (logEl.children.length > 25) logEl.removeChild(logEl.lastChild);
}

class Creature {
    constructor(gx, gy, char, color, colony = null) {
        this.gx = gx; this.gy = gy;
        this.char = char; this.baseColor = color; this.color = color;
        this.colony = colony;
        this.energy = (char === 'P') ? 220 : 150;
        this.isInfected = false;
        this.isImmune = false;
        this.standingOn = null;
        grid[gx][gy] = this;
    }

    move() {
        let loss = (this.char === 'P' ? 0.4 : 0.03); // Slightly lowered P drain to help survival
        if (this.isInfected) {
            this.color = "#bb00ff";
            if (this.char === 'P') loss *= 3;
        }

        this.energy -= loss;
        if (this.energy <= 0) return;

        let moveX = Math.floor(Math.random() * 3) - 1;
        let moveY = Math.floor(Math.random() * 3) - 1;

        if (this.char === 'P') {
            let prey = this.scan(10, (i) => i.char === 'a' || i.char === 'H' || i.char === 's');
            if (prey) {
                moveX = (prey.gx > this.gx ? 1 : prey.gx < this.gx ? -1 : 0);
                moveY = (prey.gy > this.gy ? 1 : prey.gy < this.gy ? -1 : 0);
            }
        }

        let tx = Math.max(0, Math.min(COLS - 1, this.gx + moveX));
        let ty = Math.max(0, Math.min(ROWS - 1, this.gy + moveY));
        const target = grid[tx][ty];

        // Fear of water
        if (target && target.char ===
